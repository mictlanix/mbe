@using Business.Essentials;
@using Business.Essentials.Model;
@using Business.Essentials.WebApp.Helpers;
@using Business.Essentials.WebApp.Models;
@model Search<Product>

@{
    ViewBag.Title = Resources.Title_Product;
    var CurrentUser = Html.CurrentUser() ?? new User();
    var Privilege = Html.GetPrivilege(CurrentUser, SystemObjects.Products);
}


<script src="@Url.Content("~/Scripts/jquery.cluetip.min.js")" type="text/javascript"></script>
<link href="@Url.Content("~/Content/jquery.cluetip.css")" rel="stylesheet" type="text/css" />

<h2>@Resources.DisplayName_Products</h2>

<p>
@if(Privilege.AllowCreate)
{
    @Html.ActionLink(Resources.CreateNew, "Create", new { }, new { @class = "button icon add" })
}
</p>

@using (Ajax.BeginForm(new AjaxOptions { UpdateTargetId = "search-results", LoadingElementId = "activity-indicator", OnBegin = "onSearchBegin" }))
{
    @Html.HiddenFor(x => x.Offset)
    @Html.HiddenFor(x => x.Limit)
    <div class="editor-label">
        @Html.LabelFor(x => x.Pattern)
    </div>
    <div class="search-box">
        <button type="submit" class="icon search">@Resources.Search</button>
        <div class="search-field">
            <input type="text" id="Pattern" name="Pattern" />
        </div>
    </div>
    <p>
        @if (Model.Offset >= Model.Limit)
        {
            @Html.ActionLink("<", "Index", new { Pattern = Model.Pattern, Limit = Model.Limit, Offset = Model.Offset - Model.Limit })
        }
        @if (Model.Results.Count >= Model.Limit)
        {
            @Html.ActionLink(">", "Index", new { Pattern = Model.Pattern, Limit = Model.Limit, Offset = Model.Offset + Model.Limit })
        }
    </p>
}
<div id="activity-indicator">
    <img alt="@Resources.Loading" src="@Url.Content("~/Content/images/loading-bar.gif")" />
</div>
<div id="search-results">
    @Html.Partial("_Index")
</div>
<script type="text/javascript">
    function onSearchBegin() {
        $("#search-results").html(null);
    }
</script>