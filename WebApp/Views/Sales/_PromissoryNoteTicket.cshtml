@using Business.Essentials
@using Business.Essentials.Model
@using Business.Essentials.WebApp.Models
@using Business.Essentials.WebApp.Helpers
@model SalesOrder

@{
    Layout = "~/Views/Shared/_TicketLayout.cshtml";
    ViewBag.Title = Resources.PromissoryNote;
}

<div class="display-label right">
    @Html.LabelFor(model => model.Id)
</div>
<div class="display-field right">
    @Html.DisplayFor(model => model.Id)
</div>

<div class="display-label right">
    @Html.LabelFor(model => model.Date)
</div>
<div class="display-field date right">
    @Html.DisplayFor(model => model.Date)
</div>

<div class="display-label">
    @Html.LabelFor(model => model.Customer)
</div>
<div class="display-field">
    @Html.DisplayFor(model => model.Customer.Name)
</div>

@if (Model.IsCredit)
{
    <div class="display-label">
        @Html.LabelFor(model => model.DueDate)
    </div>
    <div class="display-field date">
        @Html.DisplayFor(model => model.DueDate)
    </div>
}

<table>
@foreach (var item in Model.Details)
{
    <tr>
        <td class="line number" rowspan="2">
            @Html.DisplayFor(modelItem => item.Quantity)
        </td>
        <td colspan="2">
            @Html.DisplayFor(modelItem => item.ProductName)
        </td>
        <td class="line number" rowspan="2">
            @Html.DisplayFor(modelItem => item.Total)
        </td>
    </tr>
    <tr>
        <td class="line">
			✕
            @Html.DisplayFor(modelItem => item.Price)
            @if (item.Discount > 0)
            {
                @:- @Html.DisplayFor(modelItem => item.Discount)
            }
        </td>
        <td class="line center">
            @Html.DisplayFor(modelItem => item.ProductCode)
        </td>
    </tr>
}
    <tr>
        <td></td>
        <td></td>
        <td class="total right">@Resources.Total</td>
        <td class="total number">@Html.DisplayFor(x => x.Total)</td>
    </tr>
    @foreach (var item in Model.Payments)
    {
        <tr>
            <td></td>
            <td></td>
            <td class="right">@item.Method.GetDisplayName()</td>
            <td class="number">@Html.DisplayFor(modelItem => item.Cash)</td>
        </tr>
    }
    @if (Model.Payments.Sum(x => x.Change.GetValueOrDefault()) > 0)
    {
        <tr>
            <td></td>
            <td></td>
            <td class="right">@Resources.Change</td>
            <td class="number">@Html.DisplayFor(x => Model.Balance)</td>
        </tr>
    }
</table>

<div class="display-label display-field">
    @Html.LabelFor(model => model.Taxes)
    @Html.DisplayFor(model => model.Taxes)
</div>

<div class="legend">
    @string.Format(Configuration.PromissoryNoteContent, Model.Customer.Name, Model.Total, Model.DueDate) 
</div>

<div class="signature">
    @string.Format(Resources.Person, Model.Customer.Name)<br/>
    @Resources.Accept
</div>

<div class="display-label right">
    @Html.LabelFor(model => model.SalesPerson)
</div>
<div class="display-field right">
    @Html.DisplayFor(model => model.SalesPerson.Name)
</div>

@section Footer {
	<img src="@Url.Action("Code128", "Barcodes", new { id = string.Format("{0}", Html.DisplayFor(x => x.Id)) })" alt="@Html.DisplayFor(x => x.Id)" title="@Html.DisplayFor(x => x.Id)">
}