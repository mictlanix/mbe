@using Mictlanix.BE
@using Mictlanix.BE.Model
@using Mictlanix.BE.Web.Helpers
@model FiscalDocument

@{
    var CurrentUser = Html.CurrentUser() ?? new User();
    var Privilege = Html.GetPrivilege(CurrentUser, SystemObjects.FiscalDocuments);
}

<fieldset>
    <legend>@Resources.MasterInformation</legend>

    <div class="display-label right floating">
        @Html.LabelFor(x => x.Id):
        @Html.DisplayFor(x => x.Id)
    </div>
    <div class="display-label right floating">
        @Html.LabelFor(x => x.Batch):
        @Html.DisplayFor(x => x.Batch)
    </div>
	
@if(Model.IsCompleted) {
    <div class="display-label right floating">
        @Html.LabelFor(x => x.Serial):
        @Html.DisplayFor(x => x.Serial)
    </div>
    <div class="display-label right floating">
        @Html.LabelFor(x => x.Issued)<br/>
        @Html.DisplayFor(x => x.Issued)
    </div>
}

@if(Model.Currency != Configuration.BaseCurrency) {
    <div class="display-label right floating">
        @Html.LabelFor(x => x.Currency)
        @Model.Currency.GetDisplayName()
    </div>

    <div class="display-label right floating">
        @Html.LabelFor(x => x.ExchangeRate):
        @Html.DisplayFor(x => x.ExchangeRate)
    </div>
}

    <div class="display-label right floating">
        @Html.LabelFor(x => x.PaymentMethod):
        @Model.PaymentMethod.GetDisplayName()
    </div>
    
@if (Model.PaymentMethod != PaymentMethod.Unidentified &&
 	 Model.PaymentMethod != PaymentMethod.Cash) {
    <div class="display-label right floating">
        @Html.LabelFor(x => x.PaymentReference):
        @Html.DisplayFor(x => x.PaymentReference)
    </div>
}
	
    <div class="display-label">
        @Html.LabelFor(x => x.Issuer)<br/>
        @Html.DisplayFor(x => x.Issuer.Id)<br/>
        @Html.DisplayFor(x => x.IssuerName)
    </div>

    <div class="display-label">
        @Html.LabelFor(x => x.Customer)<br/>
        @Html.DisplayFor(x => x.Customer.Name)
    </div>
    
    <div class="display-label">
        @Html.LabelFor(x => x.Recipient)<br/>
        @Html.DisplayFor(x => x.Recipient.Id)<br/>
        @Html.DisplayFor(x => x.RecipientName)<br/>
        @Html.DisplayFor(x => x.RecipientAddress.Street)
        @Html.DisplayFor(x => x.RecipientAddress.ExteriorNumber)
        @Html.DisplayFor(x => x.RecipientAddress.InteriorNumber)<br/>
        @Html.DisplayFor(x => x.RecipientAddress.Neighborhood),
        @Html.DisplayFor(x => x.RecipientAddress.Borough)<br/>
        @Html.DisplayFor(x => x.RecipientAddress.State),
        @Html.DisplayFor(x => x.RecipientAddress.Country),
        @Html.DisplayFor(x => x.RecipientAddress.PostalCode)
    </div>

    <div class="right">
        <p>
		@if(Privilege.AllowDelete)
		{
		    using (Html.BeginForm("Cancel", "FiscalDocuments", new { id =  Model.Id }))
		    {
				if(!Model.IsCompleted && !Model.IsCancelled)
				{
		    		@Ajax.ActionLink(Resources.Edit, "Edit", new { id = Model.Id }, new AjaxOptions { UpdateTargetId = "master-section" }, new { @class = "button icon edit " + (Model.Details.Count > 0 ? "hidden" : "")})
				}
				if(!Model.IsCancelled)
				{
					<button type="submit" class="icon cancel">@Resources.Cancel</button>
				}
		    }
		}
        </p>
    </div>
</fieldset>